  return c.html(`
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encuesta MVP - Galia Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif';
        }
        .question-block {
            display: none;
        }
        .question-block.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-4 md:p-8">
        <!-- Header -->
        <div class="max-w-3xl mx-auto mb-8">
            <div class="bg-gradient-to-r from-[#008080] to-[#1b285e] text-white rounded-2xl shadow-xl p-8 text-center">
                <div class="mb-4">
                    <img src="https://page.gensparksite.com/v1/base64_upload/a70b1fe40910547351447ef32a13f4af" 
                         alt="Galia Digital Logo" 
                         class="mx-auto h-32 md:h-40 object-contain">
                </div>
                <h1 class="text-3xl md:text-4xl font-bold mb-2">GALIA - Agenda Inteligente</h1>
                <p class="text-lg opacity-90">Ay√∫danos a mejorar la vida de las peluqueras</p>
            </div>
        </div>

        <!-- Raffle Banner -->
        <div class="max-w-3xl mx-auto mb-8">
            <div class="bg-gradient-to-r from-[#E6F2F2] to-[#EBF5F5] border-2 border-[#B3D9D9] rounded-xl p-6 text-center">
                <div class="text-4xl mb-2">üéÅ</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">¬°Sorteo Especial A Coru√±a!</h2>
                <p class="text-gray-600 mb-1">Participa y gana 1 a√±o de Agenda Inteligente IA</p>
                <p class="text-[#008080] font-bold text-lg">Valor: 1.020‚Ç¨ (300‚Ç¨ setup + 720‚Ç¨ servicio anual)</p>
                <p class="text-sm text-gray-500 mt-2">üìÖ Sorteo: 24 noviembre 2025</p>
                <p class="text-xs text-gray-500 mt-2">
                    <a href="https://galiadigital.es/sorteo/" target="_blank" class="text-[#008080] underline hover:text-[#006666]">
                        üìã Ver bases legales del sorteo
                    </a>
                </p>
            </div>
        </div>

        <!-- Survey Form -->
        <div class="max-w-3xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
                <!-- Progress Bar -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-semibold text-gray-600">Progreso</span>
                        <span class="text-sm font-semibold text-[#008080]" id="progress-text">0/17</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="bg-gradient-to-r from-[#008080] to-[#1b285e] h-3 rounded-full transition-all duration-300" 
                             id="progress-bar" style="width: 0%"></div>
                    </div>
                </div>

                <form id="surveyForm">
                    <!-- Block 1: Tu Situaci√≥n Actual -->
                    <div class="question-block active" data-block="1">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">üìã Bloque 1: Tu Situaci√≥n Actual</h3>
                        
                        <!-- P1 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                1. ‚≠ê ¬øCu√°nto tiempo dedicas DIARIAMENTE a gestionar citas?
                            </label>
                            <select name="p1" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="Menos de 30 minutos">Menos de 30 minutos</option>
                                <option value="30 minutos - 1 hora">30 minutos - 1 hora</option>
                                <option value="1-2 horas">1-2 horas</option>
                                <option value="M√°s de 2 horas">M√°s de 2 horas</option>
                            </select>
                        </div>

                        <!-- P2 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                2. ‚≠ê ¬øCu√°l es tu MAYOR problema con las citas?
                            </label>
                            <select name="p2" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="No-shows (gente que no viene)">No-shows (gente que no viene)</option>
                                <option value="WhatsApps fuera de horario">WhatsApps fuera de horario</option>
                                <option value="Horas muertas sin llenar">Horas muertas sin llenar</option>
                                <option value="Listas de espera desorganizadas">Listas de espera desorganizadas</option>
                                <option value="Todo lo anterior">Todo lo anterior</option>
                            </select>
                        </div>
                    </div>

                    <!-- Block 2: Validaci√≥n de Soluci√≥n -->
                    <div class="question-block" data-block="2">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">üí° Bloque 2: Validaci√≥n de Soluci√≥n</h3>
                        
                        <!-- Info Text before P3 -->
                        <div class="bg-gradient-to-r from-[#E6F2F2] to-[#EBF5F5] border-2 border-[#B3D9D9] rounded-xl p-6 mb-6">
                            <h4 class="text-xl font-bold text-gray-800 mb-3">üí° IMAGINA ESTO:</h4>
                            <p class="text-gray-700 mb-3">Un asistente IA que gestiona tu agenda 24/7 por WhatsApp:</p>
                            <ul class="space-y-2 text-gray-700">
                                <li>‚úÖ Reduce no-shows en un 80%</li>
                                <li>‚úÖ Llena tus horas muertas autom√°ticamente</li>
                                <li>‚úÖ Gestiona listas de espera inteligentes</li>
                                <li>‚úÖ Te devuelve 8 horas a la semana</li>
                            </ul>
                        </div>

                        <!-- P3 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                3. ‚≠ê Si esto te ahorrara 8 horas/semana, ¬øcu√°nto pagar√≠as al mes?
                            </label>
                            <select name="p3" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="Nada, lo quiero gratis">Nada, lo quiero gratis</option>
                                <option value="20-40‚Ç¨/mes">20-40‚Ç¨/mes</option>
                                <option value="40-60‚Ç¨/mes">40-60‚Ç¨/mes</option>
                                <option value="60-100‚Ç¨/mes">60-100‚Ç¨/mes</option>
                                <option value="M√°s de 100‚Ç¨/mes">M√°s de 100‚Ç¨/mes</option>
                            </select>
                        </div>

                        <!-- P4 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                4. ‚≠ê ¬øQu√© te frena para automatizar tu agenda HOY?
                            </label>
                            <select name="p4" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="El precio">El precio</option>
                                <option value="No s√© si realmente funciona">No s√© si realmente funciona</option>
                                <option value="Miedo a perder control">Miedo a perder control</option>
                                <option value="No tengo tiempo de implementarlo">No tengo tiempo de implementarlo</option>
                                <option value="Desconfianza en la tecnolog√≠a">Desconfianza en la tecnolog√≠a</option>
                                <option value="Nada, lo har√≠a ahora mismo">Nada, lo har√≠a ahora mismo</option>
                            </select>
                        </div>

                        <!-- P5 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                5. ‚≠ê Si pudieras probarlo GRATIS durante 15 d√≠as, ¬ølo har√≠as?
                            </label>
                            <select name="p5" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="S√≠, ahora mismo">S√≠, ahora mismo</option>
                                <option value="S√≠, pero en 1-2 meses">S√≠, pero en 1-2 meses</option>
                                <option value="Quiz√°s, necesito m√°s informaci√≥n">Quiz√°s, necesito m√°s informaci√≥n</option>
                                <option value="No me interesa">No me interesa</option>
                            </select>
                        </div>
                    </div>

                    <!-- Block 3: Otras Necesidades -->
                    <div class="question-block" data-block="3">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">üì± Bloque 3: Otras Necesidades</h3>
                        
                        <!-- P6 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                6. ‚≠ê Adem√°s de la agenda, ¬øqu√© m√°s te QUITA TIEMPO o DINERO? (puedes marcar varias)
                            </label>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg hover:border-[#008080] cursor-pointer">
                                    <input type="checkbox" name="p6" value="Facturaci√≥n y gesti√≥n de tickets/facturas" class="mr-3 w-5 h-5 text-[#008080]">
                                    <span>Facturaci√≥n y gesti√≥n de tickets/facturas</span>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg hover:border-[#008080] cursor-pointer">
                                    <input type="checkbox" name="p6" value="Control de stock de productos" class="mr-3 w-5 h-5 text-[#008080]">
                                    <span>Control de stock de productos</span>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg hover:border-[#008080] cursor-pointer">
                                    <input type="checkbox" name="p6" value="Gesti√≥n de horarios y turnos de empleados" class="mr-3 w-5 h-5 text-[#008080]">
                                    <span>Gesti√≥n de horarios y turnos de empleados</span>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg hover:border-[#008080] cursor-pointer">
                                    <input type="checkbox" name="p6" value="N√≥minas y control de horas trabajadas" class="mr-3 w-5 h-5 text-[#008080]">
                                    <span>N√≥minas y control de horas trabajadas</span>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg hover:border-[#008080] cursor-pointer">
                                    <input type="checkbox" name="p6" value="C√°lculo de comisiones por servicios" class="mr-3 w-5 h-5 text-[#008080]">
                                    <span>C√°lculo de comisiones por servicios</span>
                                </label>
                                <label class="flex items-center p-3 border-2 border-gray-200 rounded-lg hover:border-[#008080] cursor-pointer">
                                    <input type="checkbox" name="p6" value="Cuadrar caja al final del d√≠a" class="mr-3 w-5 h-5 text-[#008080]">
                                    <span>Cuadrar caja al final del d√≠a</span>
                                </label>
                            </div>
                        </div>

                        <!-- P7 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                7. ‚≠ê ¬øSabes que en 2026 ser√° OBLIGATORIO facturar electr√≥nicamente en tiempo real?
                            </label>
                            <select name="p7" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="S√≠, y ya estoy prepar√°ndome">S√≠, y ya estoy prepar√°ndome</option>
                                <option value="S√≠, pero no s√© c√≥mo hacerlo">S√≠, pero no s√© c√≥mo hacerlo</option>
                                <option value="No ten√≠a ni idea">No ten√≠a ni idea</option>
                                <option value="Me da igual, ya ver√©">Me da igual, ya ver√©</option>
                            </select>
                        </div>

                        <!-- P8 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                8. ‚≠ê ¬øCu√°nto tiempo dedicas A LA SEMANA a gestionar stock de productos?
                            </label>
                            <select name="p8" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="Nada, no vendo productos">Nada, no vendo productos</option>
                                <option value="Menos de 1 hora">Menos de 1 hora</option>
                                <option value="1-3 horas">1-3 horas</option>
                                <option value="3-5 horas">3-5 horas</option>
                                <option value="M√°s de 5 horas">M√°s de 5 horas</option>
                            </select>
                        </div>

                        <!-- P9 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                9. ‚≠ê Si tienes empleados, ¬øc√≥mo gestionas sus horarios y turnos?
                            </label>
                            <select name="p9" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="No tengo empleados, trabajo sola">No tengo empleados, trabajo sola</option>
                                <option value="Excel / papel / WhatsApp (caos)">Excel / papel / WhatsApp (caos)</option>
                                <option value="App espec√≠fica de horarios">App espec√≠fica de horarios</option>
                                <option value="Memoria y cruzo los dedos">Memoria y cruzo los dedos</option>
                            </select>
                        </div>

                        <!-- P10 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                10. ‚≠ê ¬øPagar√≠as por un sistema que automatizara facturaci√≥n + stock + turnos + agenda TODO EN UNO?
                            </label>
                            <select name="p10" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="S√≠, si me ahorra tiempo y dolores de cabeza">S√≠, si me ahorra tiempo y dolores de cabeza</option>
                                <option value="Depende del precio">Depende del precio</option>
                                <option value="No, prefiero herramientas separadas">No, prefiero herramientas separadas</option>
                                <option value="No necesito eso">No necesito eso</option>
                            </select>
                        </div>
                    </div>

                    <!-- Block 4: Tus Datos -->
                    <div class="question-block" data-block="4">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">üìù Bloque 4: Tus Datos</h3>
                        
                        <!-- Info Text before P11 -->
                        <div class="bg-gradient-to-r from-[#E6F2F2] to-[#EBF5F5] border-2 border-[#B3D9D9] rounded-xl p-6 mb-6">
                            <h4 class="text-xl font-bold text-gray-800 mb-3">üéÅ TU REGALO INMEDIATO:</h4>
                            <p class="text-gray-700 mb-3">Al finalizar recibir√°s:</p>
                            <ul class="space-y-2 text-gray-700">
                                <li>‚úÖ An√°lisis personalizado de tu situaci√≥n</li>
                                <li>‚úÖ Plan de automatizaci√≥n a tu medida</li>
                                <li>‚úÖ Consultor√≠a gratuita de 30 minutos</li>
                            </ul>
                        </div>

                        <!-- P11 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                11. ‚≠ê Tu nombre
                            </label>
                            <input type="text" name="p11" required 
                                   placeholder="Ej: Mar√≠a Garc√≠a"
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                        </div>

                        <!-- P12 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                12. ‚≠ê Nombre de tu peluquer√≠a/sal√≥n
                            </label>
                            <input type="text" name="p12" required 
                                   placeholder="Ej: Peluquer√≠a Mar√≠a Estilistas"
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                        </div>

                        <!-- P13 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                13. ‚≠ê WhatsApp (incluye prefijo +34)
                            </label>
                            <input type="tel" name="p13" required 
                                   placeholder="Ej: +34 600 123 456"
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                        </div>

                        <!-- P14 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                14. ‚≠ê Email
                            </label>
                            <input type="email" name="p14" required 
                                   placeholder="tu@email.com"
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                        </div>

                        <!-- P15 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                15. ‚≠ê Ciudad donde est√° tu sal√≥n
                            </label>
                            <input type="text" name="p15" required 
                                   placeholder="Ej: A Coru√±a"
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                        </div>

                        <!-- P16 (OPCIONAL) -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                16. Direcci√≥n completa de tu sal√≥n (Calle + n√∫mero - opcional para sorteo)
                            </label>
                            <input type="text" name="p16" 
                                   placeholder="Ej: Calle Real 25"
                                   class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                        </div>

                        <!-- P17 -->
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-3">
                                17. ‚≠ê ¬øCu√°ndo te vendr√≠a bien que te contactemos?
                            </label>
                            <select name="p17" required class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-[#008080] focus:outline-none">
                                <option value="">Selecciona una opci√≥n...</option>
                                <option value="Esta semana">Esta semana</option>
                                <option value="Pr√≥xima semana">Pr√≥xima semana</option>
                                <option value="Dentro de 2-3 semanas">Dentro de 2-3 semanas</option>
                                <option value="Solo email, no llamar">Solo email, no llamar</option>
                            </select>
                        </div>

                        <!-- Opt-ins Section -->
                        <div class="border-t-2 border-gray-200 pt-6 mt-8">
                            <h4 class="text-lg font-bold text-gray-800 mb-4">‚úÖ Confirmaci√≥n y Permisos</h4>
                            
                            <!-- Opt-in: Sorteo -->
                            <div class="mb-4">
                                <label class="flex items-start cursor-pointer">
                                    <input type="radio" name="wantRaffle" value="si" class="mt-1 mr-3 w-5 h-5 text-[#008080]">
                                    <span class="text-gray-700">
                                        <strong>S√ç, quiero participar en el sorteo</strong> de 1 a√±o de Agenda Inteligente IA (solo para salones de A Coru√±a)
                                    </span>
                                </label>
                            </div>
                            <div class="mb-6">
                                <label class="flex items-start cursor-pointer">
                                    <input type="radio" name="wantRaffle" value="no" class="mt-1 mr-3 w-5 h-5 text-[#008080]">
                                    <span class="text-gray-700">No quiero participar en el sorteo</span>
                                </label>
                            </div>

                            <!-- Opt-in: Informe -->
                            <div class="mb-4">
                                <label class="flex items-start cursor-pointer">
                                    <input type="radio" name="wantReport" value="si" class="mt-1 mr-3 w-5 h-5 text-[#008080]">
                                    <span class="text-gray-700">
                                        <strong>S√ç, quiero recibir el informe personalizado</strong> con mi plan de automatizaci√≥n
                                    </span>
                                </label>
                            </div>
                            <div class="mb-6">
                                <label class="flex items-start cursor-pointer">
                                    <input type="radio" name="wantReport" value="no" class="mt-1 mr-3 w-5 h-5 text-[#008080]">
                                    <span class="text-gray-700">No quiero recibir el informe</span>
                                </label>
                            </div>

                            <!-- GDPR Obligatorio -->
                            <div class="bg-gray-50 border-2 border-gray-300 rounded-lg p-4 mb-6">
                                <label class="flex items-start cursor-pointer">
                                    <input type="checkbox" name="gdpr" required class="mt-1 mr-3 w-5 h-5 text-[#008080]">
                                    <span class="text-sm text-gray-700">
                                        ‚≠ê <strong>Acepto la</strong> 
                                        <a href="https://galiadigital.es/privacidad/" target="_blank" class="text-[#008080] underline hover:text-[#006666]">pol√≠tica de privacidad</a> 
                                        y el tratamiento de mis datos seg√∫n RGPD (obligatorio)
                                    </span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="flex justify-between mt-8">
                        <button type="button" id="prevBtn" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition" style="display: none;">
                            ‚Üê Anterior
                        </button>
                        <button type="button" id="nextBtn" class="px-6 py-3 bg-[#008080] text-white rounded-lg font-semibold hover:bg-[#006666] transition ml-auto">
                            Siguiente ‚Üí
                        </button>
                        <button type="submit" id="submitBtn" class="px-8 py-3 bg-gradient-to-r from-[#008080] to-[#1b285e] text-white rounded-lg font-bold hover:shadow-xl transition" style="display: none;">
                            üöÄ Enviar Encuesta
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl max-w-lg w-full p-8 text-center">
                <div class="text-6xl mb-4">üéâ</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">¬°Gracias!</h2>
                <div id="modalContent"></div>
                <button onclick="window.location.href='/'" class="mt-6 px-8 py-3 bg-[#008080] text-white rounded-lg font-bold hover:bg-[#006666] transition">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('surveyForm');
        const blocks = document.querySelectorAll('.question-block');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        
        let currentBlock = 0;
        const totalBlocks = blocks.length;

        function updateProgress() {
            const answeredQuestions = countAnsweredQuestions();
            const totalQuestions = 17;
            const percentage = (answeredQuestions / totalQuestions) * 100;
            
            progressBar.style.width = percentage + '%';
            progressText.textContent = answeredQuestions + '/' + totalQuestions;
        }

        function countAnsweredQuestions() {
            let count = 0;
            
            // P1-P5, P7-P10, P17 (selects)
            const selects = ['p1', 'p2', 'p3', 'p4', 'p5', 'p7', 'p8', 'p9', 'p10', 'p17'];
            selects.forEach(name => {
                const select = form.elements[name];
                if (select && select.value) count++;
            });
            
            // P6 (checkboxes - al menos uno)
            const p6Checked = form.querySelectorAll('input[name="p6"]:checked').length > 0;
            if (p6Checked) count++;
            
            // P11-P15 (text inputs obligatorios)
            const texts = ['p11', 'p12', 'p13', 'p14', 'p15'];
            texts.forEach(name => {
                const input = form.elements[name];
                if (input && input.value.trim()) count++;
            });
            
            // P16 es opcional, no cuenta
            
            return count;
        }

        function showBlock(index) {
            blocks.forEach((block, i) => {
                block.classList.toggle('active', i === index);
            });
            
            prevBtn.style.display = index === 0 ? 'none' : 'inline-block';
            nextBtn.style.display = index === totalBlocks - 1 ? 'none' : 'inline-block';
            submitBtn.style.display = index === totalBlocks - 1 ? 'inline-block' : 'none';
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function validateCurrentBlock() {
            const currentBlockEl = blocks[currentBlock];
            const inputs = currentBlockEl.querySelectorAll('input[required], select[required]');
            
            for (let input of inputs) {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    const name = input.name;
                    const checked = currentBlockEl.querySelector(\`input[name="\${name}"]:checked\`);
                    if (!checked && input.hasAttribute('required')) {
                        alert('Por favor, completa todos los campos obligatorios');
                        return false;
                    }
                } else {
                    if (!input.value.trim()) {
                        alert('Por favor, completa todos los campos obligatorios');
                        input.focus();
                        return false;
                    }
                }
            }
            return true;
        }

        prevBtn.addEventListener('click', () => {
            if (currentBlock > 0) {
                currentBlock--;
                showBlock(currentBlock);
            }
        });

        nextBtn.addEventListener('click', () => {
            if (validateCurrentBlock() && currentBlock < totalBlocks - 1) {
                currentBlock++;
                showBlock(currentBlock);
                updateProgress();
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!validateCurrentBlock()) return;

            const formData = new FormData(form);
            const data = {};
            
            // Get all form values
            for (let [key, value] of formData.entries()) {
                if (key === 'p6') {
                    // Multiple checkboxes
                    if (!data[key]) data[key] = [];
                    data[key].push(value);
                } else {
                    data[key] = value;
                }
            }
            
            // Convert p6 array to string
            if (Array.isArray(data.p6)) {
                data.p6 = data.p6.join(', ');
            }

            try {
                const response = await fetch('/api/submit-survey', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    let message = \`<p class="text-gray-700 mb-4">Tu respuesta ha sido registrada correctamente.</p>\`;
                    message += \`<p class="text-gray-600 mb-2"><strong>Prioridad:</strong> \${result.priority}</p>\`;
                    
                    if (result.raffleNumber) {
                        message += \`<div class="bg-[#E6F2F2] border-2 border-[#B3D9D9] rounded-lg p-4 mt-4">\`;
                        message += \`<p class="text-lg font-bold text-[#008080]">üéÅ ¬°Est√°s en el sorteo!</p>\`;
                        message += \`<p class="text-2xl font-bold text-[#008080] mt-2">N√∫mero: #\${result.raffleNumber}</p>\`;
                        message += \`<p class="text-sm text-gray-600 mt-2">Sorteo: 24 noviembre 2025</p>\`;
                        message += \`</div>\`;
                    }
                    
                    document.getElementById('modalContent').innerHTML = message;
                    document.getElementById('successModal').classList.remove('hidden');
                    document.getElementById('successModal').classList.add('flex');
                }
            } catch (error) {
                alert('Error al enviar la encuesta. Por favor, intenta de nuevo.');
                console.error(error);
            }
        });

        // Update progress on any input change
        form.addEventListener('input', updateProgress);
        form.addEventListener('change', updateProgress);

        // Initialize
        showBlock(0);
        updateProgress();
    </script>
</body>
</html>
  `)
}

export default app
